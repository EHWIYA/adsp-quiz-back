# 학습 모드 리디자인 - 백엔드 작업 완료 안내

안녕하세요. 프론트엔드 개발팀 여러분께,

요청하신 **학습 모드 리디자인 백엔드 작업**이 완료되어 배포되었습니다. 
아래 내용을 확인하시고 프론트엔드 연동 작업을 진행해 주시기 바랍니다.

---

## ✅ 완료된 작업 내역

### 1. 과목 분류 세분화 (3단계 계층 구조)

**데이터베이스 구조 변경 완료:**
- `Subject` (과목명) → `MainTopic` (주요항목) → `SubTopic` (세부항목)
- 마이그레이션 완료 및 배포 완료

**API 엔드포인트:**

#### 1-1. 과목 목록 조회
```
GET /api/v1/subjects
```
**응답 형식:**
```json
[
  {
    "id": 1,
    "name": "데이터 이해",
    "description": "데이터의 기본 개념과 가치"
  }
]
```

#### 1-2. 주요항목 목록 조회
```
GET /api/v1/subjects/{subject_id}/main-topics
```
**응답 형식:**
```json
{
  "main_topics": [
    {
      "id": 1,
      "name": "데이터의 이해",
      "description": "데이터와 정보의 개념",
      "subject_id": 1
    }
  ],
  "total": 1
}
```

#### 1-3. 세부항목 목록 조회
```
GET /api/v1/main-topics/{main_topic_id}/sub-topics
```
**응답 형식:**
```json
{
  "sub_topics": [
    {
      "id": 1,
      "name": "데이터와 정보",
      "description": "데이터와 정보의 차이점",
      "main_topic_id": 1
    }
  ],
  "total": 1
}
```

---

### 2. 학습 모드 문제 생성 API

**엔드포인트:**
```
POST /api/v1/quiz/generate-study
```

**요청 형식:**
```json
{
  "sub_topic_id": 1,
  "quiz_count": 10
}
```

**응답 형식:**
```json
{
  "quizzes": [
    {
      "id": 1,
      "question": "문제 내용",
      "options": ["선택지1", "선택지2", "선택지3", "선택지4"],
      "correct_answer": 0,
      "explanation": "해설"
    }
    // ... 9개 더
  ],
  "total_count": 10
}
```

**주요 기능:**
- ✅ 10개 문제 일괄 생성 (기본값: 10개, 최대: 50개)
- ✅ 세부항목(`sub_topic_id`)의 핵심 정보(`core_content`) 기반 문제 생성
- ✅ 문제 캐싱/재활용 시스템 (DB에 저장된 문제 우선 사용)
- ✅ 캐시 부족 시에만 AI로 새 문제 생성

---

### 3. 문제 캐싱/재활용 시스템

**동작 방식:**
1. 요청 시 먼저 DB에서 해당 `sub_topic_id`의 기존 문제 조회
2. 요청한 개수(`quiz_count`)만큼 있으면 캐시된 문제 반환
3. 부족한 경우에만 AI로 새로 생성
4. 새로 생성한 문제는 DB에 저장하여 다음 요청 시 재사용

**캐시 무효화:**
- 세부항목의 핵심 정보(`core_content`)가 업데이트되면 해당 세부항목의 문제를 수동으로 삭제하거나 재생성 필요
- (향후 관리자 API 추가 예정)

---

## 📋 API 문서

**Swagger UI:**
- 프로덕션: https://adsp-api.livbee.co.kr/docs
- 개발 환경: http://localhost:8001/docs (로컬 개발 시)

**ReDoc:**
- 프로덕션: https://adsp-api.livbee.co.kr/redoc

---

## 🔍 프론트엔드 연동 체크리스트

### Phase 1: 핵심 기능 (즉시 진행 가능)

- [ ] **과목 분류 세분화 UI**
  - [ ] 3단계 드롭다운 구현 (과목명 → 주요항목 → 세부항목)
  - [ ] API 연동 (`GET /api/v1/subjects`, `/subjects/{id}/main-topics`, `/main-topics/{id}/sub-topics`)
  - [ ] 로딩 상태 처리

- [ ] **학습 모드 플로우 변경**
  - [ ] 문제 생성 방식 선택 제거 (텍스트/YouTube URL 입력 제거)
  - [ ] 분류 선택 후 "학습 시작하기" 버튼 클릭
  - [ ] `POST /api/v1/quiz/generate-study` 호출
  - [ ] 10개 문제 일괄 표시
  - [ ] 시험 모드와 유사한 플로우 (문제 1/10, 2/10... 진행)

---

## ⚠️ 주의사항

1. **핵심 정보 필수:**
   - 세부항목에 `core_content`(핵심 정보)가 없으면 문제 생성 불가
   - 현재는 DB에 직접 입력 필요 (향후 관리자 API 추가 예정)

2. **에러 처리:**
   - `404 Not Found`: 세부항목을 찾을 수 없음
   - `400 Bad Request`: 핵심 정보가 없음
   - `503 Service Unavailable`: Gemini API 서비스 장애

3. **문제 개수 제한:**
   - `quiz_count`: 1~50 사이 (기본값: 10)

---

## 🧪 테스트 방법

### 1. 과목 분류 조회 테스트
```bash
# 과목 목록
curl https://adsp-api.livbee.co.kr/api/v1/subjects

# 주요항목 목록 (subject_id=1 가정)
curl https://adsp-api.livbee.co.kr/api/v1/subjects/1/main-topics

# 세부항목 목록 (main_topic_id=1 가정)
curl https://adsp-api.livbee.co.kr/api/v1/main-topics/1/sub-topics
```

### 2. 학습 모드 문제 생성 테스트
```bash
curl -X POST https://adsp-api.livbee.co.kr/api/v1/quiz/generate-study \
  -H "Content-Type: application/json" \
  -d '{
    "sub_topic_id": 1,
    "quiz_count": 10
  }'
```

---

## 📝 다음 단계 (Phase 2, 선택사항)

- [ ] 핵심 정보 관리 시스템 (관리자 API)
- [ ] 핵심 정보 등록/수정/삭제 UI
- [ ] 인증/권한 시스템 연동

---

## 📧 문의 및 지원

작업 중 발생하는 에러나 문제는 언제든지 공유해 주시기 바랍니다.
특히 다음 사항들을 확인해 주시면 감사하겠습니다:

1. API 응답 형식이 요청하신 형식과 일치하는지
2. 에러 처리 및 예외 상황 대응
3. 성능 및 응답 시간

---

**작업 완료일:** 2026-01-19  
**배포 상태:** ✅ 성공 (헬스체크 통과)  
**API URL:** https://adsp-api.livbee.co.kr

감사합니다.

---

백엔드 개발팀
